<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{0}</title>
    <script>  
      /*
        In production, we register a service worker to serve assets from local cache.

        This lets the app load faster on subsequent visits in production, and gives
        it offline capabilities. However, it also means that developers (and users)
        will only see deployed updates on the "N+1" visit to a page, since previously
        cached resources are updated in the background. 

        It's worth nothing this the N+1 visit happens automatically after visit N, because
        the logic below reloads the page when it detects changes in service workers cache key

        To learn more about the benefits of this model, read https://goo.gl/KwvDNy.
        This link also includes instructions on opting out of this behavior.
      */

      (function() {{
          function register() {{
          if ('serviceWorker' in navigator) {{
            window.addEventListener('load', () => {{
              const swUrl = `/service-worker.js`;
              registerSW(swUrl);
            }});
          }}
        }}

        async function registerSW(swUrl) {{
          try {{
            const registration = await navigator.serviceWorker.register(swUrl);
            registration.onupdatefound = () => {{
                const installingWorker = registration.installing;
                installingWorker.onstatechange = () => {{
                  if (installingWorker.state === 'installed') {{
                    if (navigator.serviceWorker.controller) {{
                      // At this point, the old content will have been purged and
                      // the fresh content will have been added to the cache.
                      // It's the perfect time to reload the page.
                      debugger
                      console.info('Detected a new service worker cache version, reloading...')
                      window.location.reload();
                    }} else {{
                      // At this point, everything has been precached.
                      // It's the perfect time to display a
                      // "Content is cached for offline use." message.
                      console.info('Content is cached for offline use.');
                    }}
                  }}
                }}
              }}
            }}
            catch(error) {{
              console.error('Error during service worker registration:', error);
            }};
        }};
        register();
      }})()
    </script>
    <script src="/sys/webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="/sys/polymer/polymer.html">
    <link rel="import" href="/sys/starcounter.html">
    <link rel="stylesheet" href="/sys/uniform.css/uniform.css">
    <link rel="manifest">
</head>
<body>
    <dom-bind id="palindrom-root">
        <template>
            <starcounter-include view-model="{{{{model}}}}"></starcounter-include>
        </template>
    </dom-bind>
    
    <palindrom-client ref="palindrom-root" remote-url="{1}"></palindrom-client>
</body>
</html>
